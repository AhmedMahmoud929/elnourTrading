<!-- Define ejs functions -->

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="../../icons/favicon.ico" rel="shortcut icon" />
    <title>Admin Permissions</title>
    <link rel="stylesheet" href="../../../css/index.css" />
    <link rel="stylesheet" href="../../../css/dashboard/dashboard.css" />
    <link rel="stylesheet" href="../../../css/dashboard/admins.css" />

    <!-- Boxicons CSS -->
    <link
      flex
      href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css"
      rel="stylesheet"
    />
    <!-- Font Awesome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <!-- AOS Library -->
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet" />
  </head>
  <body>
    <!-- ASIDE -->
    <%- include("../../parts/aside.ejs",{active:"admins"}) %>
    <!-- SECTION -->
    <section class="home-section">
      <header>
        <div class="text">Admin Permissions</div>
        <a href="/dashboard/admins/">
          <span class="link_name">Back</span>
          <i class="bx bx-undo"></i>
        </a>
      </header>
      <main id="admins">
        <div class="form-cont">
          <h1 class="full-name">Full name : <i><%= admin.fullName %></i></h1>
          <h2 class="username">Username : <i><%= admin.username %></i></h2>
          <div class="permissions">
            <p>Permissions:</p>
            <div class="permissions-grid">
              <% for (let [key,value] of Object.entries(admin.permissions) ) {%>
              <label>
                <input type="checkbox" id="<%= admin._id%>"
                class="permission-checkbox" name="<%=key%>" value="<%=value%>"
                <% if(value==true) { %> checked <%}%> /> <%=
                formatSpacedString(key) %>
              </label>
              <%}%>
            </div>
          </div>
        </div>
      </main>
    </section>

    <!-- AOS Library -->
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script>
      AOS.init();
    </script>
    <script>
      const viewForms = document.querySelectorAll("#viewForm");

      viewForms.forEach((f, ix) => {
        f.addEventListener("submit", (e) => {
          e.preventDefault();
          const newWindow = window.open("", "_blank");
          newWindow.location.href = f.children[0].href;
        });
      });
    </script>
    <script>
      function updatePermission(id, key, value) {
        fetch("/dashboard/admins/update-permissions", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({ id, key, value }),
        })
          .then((response) => response.json())
          .then((data) => {
            if (data.success) {
              location.reload();
            } else {
              console.error("Failed to update permission:", data.message);
            }
          })
          .catch((error) => console.error("Error:", error));
      }

      document.addEventListener("DOMContentLoaded", function () {
        document
          .querySelectorAll(".permission-checkbox")
          .forEach((checkbox) => {
            checkbox.addEventListener("change", function () {
              const id = this.id;
              const key = this.name;
              const value = this.checked;
              updatePermission(id, key, value);
            });
          });
      });
    </script>
  </body>
</html>
